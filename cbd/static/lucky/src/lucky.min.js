define(function(e,t,n){function i(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}function r(e,t){return i(e,t)<=(e.width+t.width)/2}function o(e,t){var n=t.y-e.y,r=t.x-e.x,o=i(e,t),a=Math.ceil(((e.width+t.width)/2-o)/u),s=n>0?Math.ceil(a*n/o):Math.floor(a*n/o),l=r>0?Math.ceil(a*r/o):Math.floor(a*r/o);e.lucky?(t._xMove+=2*l,t._yMove+=2*s):t.lucky?(e._xMove+=-2*l,e._yMove+=-2*s):(e._yMove+=-1*s,t._yMove+=s,e._xMove+=-1*l,t._xMove+=l)}var a=e("jquery");e("jquery-easing");var s=e("./user"),l=100,u=4;n.exports={users:[],init:function(e){a("#container").css("background","none"),this.data=e,this.users=e.map(function(t){return new s(t,e[t])}),this._bindUI()},_bindUI:function(){function e(){"start"===n.getAttribute("data-action")?(n.setAttribute("data-action","stop"),n.innerHTML=n.getAttribute("data-text-stop"),t.start()):(n.setAttribute("data-action","start"),n.innerHTML=n.getAttribute("data-text-start"),t.stop())}var t=this,n=document.querySelector("#go");n.innerHTML=n.getAttribute("data-text-start"),n.addEventListener("click",e,!1),a("#lucky-balls").on("click","li",function(e){var n=a(e.target),i=n.text();t.addItem(i),t.hit(),n.remove()}),a("#balls").on("click","li",function(e){for(var n=a(e.target),i=n.text(),r=0;t.users.length>r;r++){var o=t.users[r];if(o.name===i){t.moveLucky(),t.luckyUser!==o&&t.setLucky(o);break}}}),document.addEventListener("keydown",function(n){"32"==n.keyCode?e():"27"==n.keyCode&&(t.moveLucky(),a("#lucky-balls li").eq(0).click())},!1)},start:function(){this.timer&&clearTimeout(this.timer),this.moveLucky(),this.users.forEach(function(e){e.start()})},stop:function(){var e=this.users,t=0,n=e[0];e.forEach(function(e){e.stop(),e.zIndex>t&&(n=e,t=e.zIndex)}),n.bang(),this.hit(),this.luckyUser=n},removeItem:function(e){for(var t=0;this.users.length>t;t++){var n=this.users[t];n===e&&this.users.splice(t,1)}},addItem:function(e){this.users.push(new s(e))},moveLucky:function(){var e=this.luckyUser;e&&(e.el[0].style.cssText="",e.el.prependTo("#lucky-balls"),this.removeItem(e),this.luckyUser=null)},setLucky:function(e){this.users.forEach(function(e){e.stop()}),this.luckyUser=e,e.bang(),this.hit()},hit:function(){var e=this,t=0,n=this.users;n.forEach(function(e){e.beginHit()});for(var i=0;n.length>i;i++)for(var a=i+1;n.length>a;a++)r(n[i],n[a])&&(o(n[i],n[a]),t++);n.forEach(function(e){e.hitMove()}),t>0&&(this.timer=setTimeout(function(){e.hit()},l))}}});